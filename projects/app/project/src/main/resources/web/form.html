<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>OpenMUC Channel Config</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .device-section, .channel-section { border: 1px solid #ccc; padding: 15px; margin-bottom: 15px; }
        .hidden { display: none; }
        label { display: inline-block; width: 150px; }
        input, select { margin-bottom: 10px; }
        button { margin-top: 10px; }
    </style>
    <script>
        function toggleConnectionFields() {
            const connType = document.getElementById("driver").value;
            document.getElementById("tcpFields").style.display = (connType === "modbus-tcp") ? "block" : "none";
            document.getElementById("rtuFields").style.display = (connType === "modbus-rtu") ? "block" : "none";
        }

        function addChannel() {
            const container = document.getElementById("channelsContainer");
            const idx = container.children.length + 1;
            const div = document.createElement("div");
            div.className = "channel-section";
            div.innerHTML = `
                <h4>Channel ${idx}</h4>
                <label>Channel ID:</label><input type="text" name="channelId" required><br>
                <label>Unit Id:</label><input type="number" name="unitId" required><br>
                <label>Primary Table:</label>
                  <select name="primaryTable">
                    <option value="HOLDING_REGISTER">HOLDING_REGISTER</option>
                    <option value="INPUT_REGISTER">INPUT_REGISTER</option>
                    <option value="COIL">COIL</option>
                    <option value="DISCRETE_INPUT">DISCRETE_INPUT</option>
                  </select><br>
                <label>Address:</label><input type="number" name="address" required><br>
                <label>Datatype:</label>
                  <select name="datatype">
                    <option value="INTEGER">INTEGER</option>
                    <option value="FLOAT">FLOAT</option>
                    <option value="BOOLEAN">BOOLEAN</option>
                    <option value="STRING">STRING</option>
                  </select><br>
            `;
            container.appendChild(div);
        }
    </script>
</head>
<body>
<h2>Create Channel Configuration</h2>
<form method="post" action="/config">
    <div class="device-section">
        <h3>Device Settings</h3>
        <label>Device ID:</label><input type="text" name="deviceId" required><br>
        <label>Driver:</label>
        <select id="driver" name="driver" onchange="toggleConnectionFields()" required>
            <option value="">--Select--</option>
            <option value="modbus-tcp">TCP</option>
            <option value="modbus-rtu">RTU</option>
        </select><br>

        <div id="tcpFields" class="hidden">
            <label>Host:</label><input type="text" name="host"><br>
            <label>Port:</label><input type="number" name="port" value="502"><br>
        </div>

        <div id="rtuFields" class="hidden">
            <label>Port Name:</label><input type="text" name="portName"><br>
            <label>Baud Rate:</label><input type="number" name="baudRate" value="9600"><br>
            <label>Data Bits:</label>
            <select name="dataBits">
                <option value="8">8</option>
                <option value="7">7</option>
            </select><br>
            <label>Parity:</label>
            <select name="parity">
                <option value="NONE">None</option>
                <option value="EVEN">Even</option>
                <option value="ODD">Odd</option>
            </select><br>
            <label>Stop Bits:</label>
            <select name="stopBits">
                <option value="1">1</option>
                <option value="2">2</option>
            </select><br>
            <label>Echo:</label>
            <select name="echo">
                <option value="false">False</option>
                <option value="true">True</option>
            </select><br>
            <label>Flow Control In:</label>
            <select name="flowIn">
                <option value="NONE">None</option>
                <option value="RTSCTS_IN">RTSCTS_IN</option>
            </select><br>
            <label>Flow Control Out:</label>
            <select name="flowOut">
                <option value="NONE">None</option>
                <option value="RTSCTS_OUT">RTSCTS_OUT</option>
            </select><br>
        </div>
    </div>

    <div id="channelsContainer"></div>
    <button type="button" onclick="addChannel()">Add Channel</button><br><br>
    <input type="submit" value="Generate channels.xml">
</form>
</body>
</html>
